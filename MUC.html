<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½±è§†å®‡å®™å…³ç³»ç½‘ - æ¼«å¨ç”µå½±å®‡å®™è§’è‰²ç½‘ç»œ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c1d 0%, #1a1a2e 100%);
            color: #e6e6e6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #e62429, #ffcc00, #00a8e8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0a0a0;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .chart-container {
            background: rgba(30, 30, 46, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .chart-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #ffcc00;
            display: flex;
            align-items: center;
        }
        
        .chart-title i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .chart {
            height: 600px;
            width: 100%;
        }
        
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-section {
            background: rgba(30, 30, 46, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #00a8e8;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1rem;
        }
        
        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-label {
            display: block;
            margin-bottom: 8px;
            color: #a0a0a0;
            font-size: 0.9rem;
        }
        
        .movie-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .movie-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .movie-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .movie-item.selected {
            background: rgba(0, 168, 232, 0.2);
            border-left: 3px solid #00a8e8;
        }
        
        .movie-checkbox {
            margin-right: 10px;
        }
        
        .movie-year {
            color: #ffcc00;
            font-size: 0.8rem;
            margin-left: auto;
            background: rgba(255, 204, 0, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .time-slider {
            width: 100%;
            margin: 15px 0;
        }
        
        .time-value {
            text-align: center;
            color: #ffcc00;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .control-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: #e6e6e6;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .control-btn.primary {
            background: linear-gradient(90deg, #e62429, #ff6b6b);
            color: white;
            font-weight: bold;
        }
        
        .control-btn.primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(230, 36, 41, 0.4);
        }
        
        .control-btn.secondary {
            background: linear-gradient(90deg, #00a8e8, #4e54c8);
            color: white;
            font-weight: bold;
        }
        
        .control-btn.secondary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 168, 232, 0.4);
        }
        
        .control-btn.warning {
            background: linear-gradient(90deg, #ffcc00, #ffde7d);
            color: #1a1a2e;
            font-weight: bold;
        }
        
        .control-btn.warning:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .character-info {
            background: rgba(30, 30, 46, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            z-index: 1000;
            display: none;
        }
        
        .character-info.active {
            display: block;
        }
        
        .character-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e62429, #ffcc00);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin-right: 20px;
        }
        
        .character-name {
            font-size: 1.8rem;
            color: #ffcc00;
            margin-bottom: 5px;
        }
        
        .character-actor {
            color: #a0a0a0;
            font-size: 1.1rem;
        }
        
        .character-details {
            margin-bottom: 20px;
        }
        
        .detail-item {
            margin-bottom: 10px;
            display: flex;
        }
        
        .detail-label {
            width: 100px;
            color: #00a8e8;
            font-weight: bold;
        }
        
        .detail-value {
            flex: 1;
            color: #e6e6e6;
        }
        
        .movie-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5px;
        }
        
        .movie-tag {
            background: rgba(230, 36, 41, 0.2);
            color: #ff6b6b;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: #e6e6e6;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(230, 36, 41, 0.8);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #a0a0a0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 600px;
            font-size: 1.2rem;
            color: #ffcc00;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        
        .statistics {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            color: #ffcc00;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a0a0a0;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-mask"></i> å½±è§†å®‡å®™å…³ç³»ç½‘</h1>
            <p class="subtitle">æ¢ç´¢æ¼«å¨ç”µå½±å®‡å®™è§’è‰²å…³ç³»ç½‘ç»œï¼Œå¯è§†åŒ–è§’è‰²é—´çš„å…³è”ä¸æ•…äº‹çº¿æ¼”è¿›</p>
        </header>
        
        <div class="dashboard">
            <div class="main-content">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-project-diagram"></i> æ¼«å¨ç”µå½±å®‡å®™è§’è‰²å…³ç³»å›¾
                    </div>
                    <div id="network-chart" class="chart">
                        <div class="loading">åˆå§‹åŒ–è§’è‰²å…³ç³»ç½‘ç»œ...</div>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #e62429;"></div>
                            <span>æ ¸å¿ƒè§’è‰² (å‡ºç°5+éƒ¨ç”µå½±)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #00a8e8;"></div>
                            <span>é‡è¦è§’è‰² (å‡ºç°3-4éƒ¨ç”µå½±)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffcc00;"></div>
                            <span>æ¬¡è¦è§’è‰² (å‡ºç°1-2éƒ¨ç”µå½±)</span>
                        </div>
                    </div>
                    <div class="statistics">
                        <div class="stat-item">
                            <div class="stat-value" id="total-nodes">0</div>
                            <div class="stat-label">è§’è‰²æ•°é‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-edges">0</div>
                            <div class="stat-label">å…³ç³»æ•°é‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-movies">0</div>
                            <div class="stat-label">ç”µå½±æ•°é‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avg-degree">0</div>
                            <div class="stat-label">å¹³å‡å…³è”åº¦</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-film"></i> æ¼«å¨ç”µå½±æ—¶é—´çº¿
                    </div>
                    <div id="timeline-chart" class="chart" style="height: 200px;"></div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="control-section">
                    <div class="section-title">
                        <i class="fas fa-filter"></i> ç”µå½±ç­›é€‰
                    </div>
                    <div class="filter-options">
                        <div class="button-group">
                            <button class="control-btn primary" id="select-all">
                                <i class="fas fa-check-square"></i> å…¨é€‰
                            </button>
                            <button class="control-btn warning" id="clear-all">
                                <i class="fas fa-times-circle"></i> æ¸…ç©º
                            </button>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">é€‰æ‹©ç”µå½± (å…±<span id="movie-count">0</span>éƒ¨):</label>
                            <div class="movie-list" id="movie-list">
                                <!-- ç”µå½±åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <div class="section-title">
                        <i class="fas fa-sliders-h"></i> æ—¶é—´çº¿æ§åˆ¶
                    </div>
                    <div class="filter-options">
                        <div class="filter-group">
                            <label class="filter-label">æ—¶é—´è½´: <span id="time-value" class="time-value">2008</span></label>
                            <input type="range" min="2008" max="2023" value="2023" class="time-slider" id="time-slider">
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #a0a0a0;">
                                <span>2008</span>
                                <span>2023</span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button class="control-btn secondary" id="play-timeline">
                                <i class="fas fa-play"></i> æ’­æ”¾æ—¶é—´çº¿
                            </button>
                            <button class="control-btn" id="reset-timeline">
                                <i class="fas fa-redo"></i> é‡ç½®
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <div class="section-title">
                        <i class="fas fa-users"></i> è§’è‰²ç¤¾åŒº
                    </div>
                    <div class="filter-options">
                        <div class="button-group">
                            <button class="control-btn secondary" id="detect-communities">
                                <i class="fas fa-users-cog"></i> æ£€æµ‹ç¤¾åŒº
                            </button>
                            <button class="control-btn" id="reset-communities">
                                <i class="fas fa-eye-slash"></i> éšè—ç¤¾åŒº
                            </button>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">å·²æ£€æµ‹åˆ° <span id="community-count">0</span> ä¸ªè§’è‰²ç¤¾åŒº:</label>
                            <div class="movie-list" id="community-list">
                                <!-- ç¤¾åŒºåˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <div class="section-title">
                        <i class="fas fa-search"></i> è§’è‰²æœç´¢
                    </div>
                    <div class="filter-options">
                        <div class="filter-group">
                            <label class="filter-label">æœç´¢è§’è‰²:</label>
                            <input type="text" id="character-search" placeholder="è¾“å…¥è§’è‰²åç§°..." style="
                                width: 100%;
                                padding: 10px;
                                border-radius: 6px;
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                color: #e6e6e6;
                                margin-bottom: 10px;
                            ">
                        </div>
                        <div class="button-group">
                            <button class="control-btn primary" id="highlight-central">
                                <i class="fas fa-star"></i> é«˜äº®æ ¸å¿ƒè§’è‰²
                            </button>
                            <button class="control-btn" id="reset-network">
                                <i class="fas fa-sync-alt"></i> é‡ç½®è§†å›¾
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>å½±è§†å®‡å®™å…³ç³»ç½‘æ•°æ®å¯è§†åŒ–é¡¹ç›® | æ•°æ®æ¥æºï¼šæ¨¡æ‹Ÿæ•°æ®ï¼ˆå¯æ›¿æ¢ä¸ºTMDB APIçœŸå®æ•°æ®ï¼‰</p>
            <p>æ³¨ï¼šæœ¬é¡µé¢å±•ç¤ºæ•°æ®ä¸ºæ¨¡æ‹Ÿæ•°æ®ï¼Œä»…ç”¨äºæ¼”ç¤ºç›®çš„ã€‚å®é™…åº”ç”¨ä¸­å¯æ¥å…¥TMDB APIè·å–çœŸå®æ•°æ®</p>
        </footer>
    </div>
    
    <!-- è§’è‰²ä¿¡æ¯å¼¹çª— -->
    <div class="overlay" id="overlay"></div>
    <div class="character-info" id="character-info">
        <button class="close-btn" id="close-info">
            <i class="fas fa-times"></i>
        </button>
        <div class="character-header">
            <div class="character-avatar" id="character-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div>
                <div class="character-name" id="character-name">è§’è‰²åç§°</div>
                <div class="character-actor" id="character-actor">æ¼”å‘˜å§“å</div>
            </div>
        </div>
        <div class="character-details">
            <div class="detail-item">
                <div class="detail-label">å‡ºç°ç”µå½±:</div>
                <div class="detail-value">
                    <div class="movie-tags" id="character-movies">
                        <!-- ç”µå½±æ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            <div class="detail-item">
                <div class="detail-label">å…³è”è§’è‰²:</div>
                <div class="detail-value">
                    <div class="movie-tags" id="character-connections">
                        <!-- å…³è”è§’è‰²æ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            <div class="detail-item">
                <div class="detail-label">ç”µå½±æ•°é‡:</div>
                <div class="detail-value" id="character-movie-count">0</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">å…³è”åº¦:</div>
                <div class="detail-value" id="character-degree">0</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">è§’è‰²ç±»å‹:</div>
                <div class="detail-value" id="character-type">æ¬¡è¦è§’è‰²</div>
            </div>
        </div>
    </div>

    <script>
        // MCUæ¨¡æ‹Ÿæ•°æ®
        const mcuData = {
            movies: [
                { id: 1, title: "é’¢é“ä¾ ", year: 2008, color: "#e62429" },
                { id: 2, title: "æ— æ•Œæµ©å…‹", year: 2008, color: "#77dd77" },
                { id: 3, title: "é’¢é“ä¾ 2", year: 2010, color: "#e62429" },
                { id: 4, title: "é›·ç¥", year: 2011, color: "#4e54c8" },
                { id: 5, title: "ç¾å›½é˜Ÿé•¿", year: 2011, color: "#00a8e8" },
                { id: 6, title: "å¤ä»‡è€…è”ç›Ÿ", year: 2012, color: "#ffcc00" },
                { id: 7, title: "é’¢é“ä¾ 3", year: 2013, color: "#e62429" },
                { id: 8, title: "é›·ç¥2", year: 2013, color: "#4e54c8" },
                { id: 9, title: "ç¾å›½é˜Ÿé•¿2", year: 2014, color: "#00a8e8" },
                { id: 10, title: "é“¶æ²³æŠ¤å«é˜Ÿ", year: 2014, color: "#ff6b6b" },
                { id: 11, title: "å¤ä»‡è€…è”ç›Ÿ2", year: 2015, color: "#ffcc00" },
                { id: 12, title: "èšäºº", year: 2015, color: "#ffa36c" },
                { id: 13, title: "ç¾å›½é˜Ÿé•¿3", year: 2016, color: "#00a8e8" },
                { id: 14, title: "å¥‡å¼‚åšå£«", year: 2016, color: "#8f94fb" },
                { id: 15, title: "é“¶æ²³æŠ¤å«é˜Ÿ2", year: 2017, color: "#ff6b6b" },
                { id: 16, title: "èœ˜è››ä¾ :è‹±é›„å½’æ¥", year: 2017, color: "#e62429" },
                { id: 17, title: "é›·ç¥3", year: 2017, color: "#4e54c8" },
                { id: 18, title: "é»‘è±¹", year: 2018, color: "#000000" },
                { id: 19, title: "å¤ä»‡è€…è”ç›Ÿ3", year: 2018, color: "#ffcc00" },
                { id: 20, title: "èšäºº2", year: 2018, color: "#ffa36c" },
                { id: 21, title: "æƒŠå¥‡é˜Ÿé•¿", year: 2019, color: "#ffde7d" },
                { id: 22, title: "å¤ä»‡è€…è”ç›Ÿ4", year: 2019, color: "#ffcc00" },
                { id: 23, title: "èœ˜è››ä¾ :è‹±é›„è¿œå¾", year: 2019, color: "#e62429" }
            ],
            
            characters: [
                { 
                    id: 1, 
                    name: "æ‰˜å°¼Â·æ–¯å¡”å…‹ / é’¢é“ä¾ ", 
                    actor: "å°ç½—ä¼¯ç‰¹Â·å”å°¼",
                    movies: [1, 3, 6, 7, 11, 13, 19, 22],
                    type: "core", // æ ¸å¿ƒè§’è‰²
                    color: "#e62429",
                    avatar: "ğŸ¤–"
                },
                { 
                    id: 2, 
                    name: "å²è’‚å¤«Â·ç½—æ°æ–¯ / ç¾å›½é˜Ÿé•¿", 
                    actor: "å…‹é‡Œæ–¯Â·åŸƒæ–‡æ–¯",
                    movies: [5, 6, 9, 11, 13, 19, 22],
                    type: "core",
                    color: "#00a8e8",
                    avatar: "ğŸ›¡ï¸"
                },
                { 
                    id: 3, 
                    name: "æ‰˜å°” / é›·ç¥", 
                    actor: "å…‹é‡Œæ–¯Â·æµ·å§†æ–¯æ²ƒæ–¯",
                    movies: [4, 6, 8, 11, 17, 19, 22],
                    type: "core",
                    color: "#4e54c8",
                    avatar: "âš¡"
                },
                { 
                    id: 4, 
                    name: "å¸ƒé²æ–¯Â·ç­çº³ / æµ©å…‹", 
                    actor: "é©¬å…‹Â·é²æ³•æ´›",
                    movies: [6, 11, 13, 17, 19, 22],
                    type: "important",
                    color: "#77dd77",
                    avatar: "ğŸ’ª"
                },
                { 
                    id: 5, 
                    name: "å¨œå¡”èÂ·ç½—æ›¼è¯ºå¤« / é»‘å¯¡å¦‡", 
                    actor: "æ–¯å˜‰ä¸½Â·çº¦ç¿°é€Š",
                    movies: [3, 6, 9, 11, 13, 19, 22],
                    type: "core",
                    color: "#ff6b6b",
                    avatar: "ğŸ•·ï¸"
                },
                { 
                    id: 6, 
                    name: "å…‹æ—ç‰¹Â·å·´é¡¿ / é¹°çœ¼", 
                    actor: "æ°ç‘ç±³Â·é›·çº³",
                    movies: [3, 6, 11, 13, 22],
                    type: "important",
                    color: "#8f94fb",
                    avatar: "ğŸ¹"
                },
                { 
                    id: 7, 
                    name: "å½¼å¾—Â·å¸•å…‹ / èœ˜è››ä¾ ", 
                    actor: "æ±¤å§†Â·èµ«å…°å¾·",
                    movies: [13, 16, 19, 22, 23],
                    type: "important",
                    color: "#e62429",
                    avatar: "ğŸ•¸ï¸"
                },
                { 
                    id: 8, 
                    name: "ç‰¹æŸ¥æ‹‰ / é»‘è±¹", 
                    actor: "æŸ¥å¾·ç»´å…‹Â·åšæ–¯æ›¼",
                    movies: [13, 18, 19, 22],
                    type: "important",
                    color: "#000000",
                    avatar: "ğŸ†"
                },
                { 
                    id: 9, 
                    name: "æ–¯è’‚èŠ¬Â·æ–¯ç‰¹å…°å¥‡ / å¥‡å¼‚åšå£«", 
                    actor: "æœ¬å°¼è¿ªå…‹ç‰¹Â·åº·ä¼¯å·´å¥‡",
                    movies: [14, 19, 22],
                    type: "important",
                    color: "#8f94fb",
                    avatar: "ğŸŒ€"
                },
                { 
                    id: 10, 
                    name: "å½¼å¾—Â·å¥å°” / æ˜Ÿçˆµ", 
                    actor: "å…‹é‡Œæ–¯Â·å¸•æ‹‰ç‰¹",
                    movies: [10, 15, 19, 22],
                    type: "important",
                    color: "#ff6b6b",
                    avatar: "ğŸš€"
                },
                { 
                    id: 11, 
                    name: "æ—ºè¾¾Â·é©¬å…‹è¥¿è«å¤« / çŒ©çº¢å¥³å·«", 
                    actor: "ä¼Šä¸½èç™½Â·å¥¥å°”æ£®",
                    movies: [11, 13, 19, 22],
                    type: "important",
                    color: "#ff6b6b",
                    avatar: "ğŸ”®"
                },
                { 
                    id: 12, 
                    name: "å¹»è§†", 
                    actor: "ä¿ç½—Â·è´å¦å°¼",
                    movies: [11, 13, 19],
                    type: "minor",
                    color: "#8f94fb",
                    avatar: "ğŸ’"
                },
                { 
                    id: 13, 
                    name: "å·´åŸºÂ·å·´æ©æ–¯ / å†¬å…µ", 
                    actor: "å¡å·´æ–¯è’‚å®‰Â·æ–¯å¦",
                    movies: [5, 9, 13, 22],
                    type: "important",
                    color: "#00a8e8",
                    avatar: "â„ï¸"
                },
                { 
                    id: 14, 
                    name: "å±±å§†Â·å¨å°”é€Š / çŒé¹°", 
                    actor: "å®‰ä¸œå°¼Â·éº¦å‡¯",
                    movies: [9, 13, 19, 22],
                    type: "important",
                    color: "#00a8e8",
                    avatar: "ğŸ¦…"
                },
                { 
                    id: 15, 
                    name: "æ´›åŸº", 
                    actor: "æ±¤å§†Â·å¸Œå¾·å‹’æ–¯é¡¿",
                    movies: [4, 6, 8, 17],
                    type: "important",
                    color: "#4e54c8",
                    avatar: "ğŸƒ"
                },
                { 
                    id: 16, 
                    name: "å°¼å…‹Â·å¼—ç‘", 
                    actor: "å¡ç¼ªå°”Â·æ°å…‹é€Š",
                    movies: [1, 3, 6, 9, 11, 21],
                    type: "important",
                    color: "#000000",
                    avatar: "ğŸ‘ï¸"
                },
                { 
                    id: 17, 
                    name: "ç›åˆ©äºšÂ·å¸Œå°”", 
                    actor: "å¯‡ç¢§Â·å²è«å¾·æ–¯",
                    movies: [6, 9, 11, 13],
                    type: "minor",
                    color: "#a0a0a0",
                    avatar: "ğŸ‘©"
                },
                { 
                    id: 18, 
                    name: "ä½©ç€Â·æ³¢èŒ¨", 
                    actor: "æ ¼æ¸©å¦®ä¸Â·å¸•ç‰¹æ´›",
                    movies: [1, 3, 7, 19, 22],
                    type: "minor",
                    color: "#e62429",
                    avatar: "ğŸ‘©"
                },
                { 
                    id: 19, 
                    name: "å“ˆçš®Â·éœæ ¹", 
                    actor: "ä¹”æ©Â·è´¹å„’",
                    movies: [1, 3, 7, 16, 23],
                    type: "minor",
                    color: "#e62429",
                    avatar: "ğŸ‘¨"
                },
                { 
                    id: 20, 
                    name: "ç®€Â·ç¦æ–¯ç‰¹", 
                    actor: "å¨œå¡”è‰Â·æ³¢ç‰¹æ›¼",
                    movies: [4, 8],
                    type: "minor",
                    color: "#4e54c8",
                    avatar: "ğŸ‘©"
                }
            ],
            
            // é¢„å®šä¹‰çš„ç¤¾åŒºï¼ˆè§’è‰²å›¢ä½“ï¼‰
            communities: [
                {
                    id: 1,
                    name: "å¤ä»‡è€…è”ç›Ÿæ ¸å¿ƒ",
                    color: "#ffcc00",
                    characters: [1, 2, 3, 4, 5, 6]
                },
                {
                    id: 2,
                    name: "é“¶æ²³æŠ¤å«é˜Ÿ",
                    color: "#ff6b6b",
                    characters: [10]
                },
                {
                    id: 3,
                    name: "å¥‡å¼‚åšå£«ç³»åˆ—",
                    color: "#8f94fb",
                    characters: [9]
                },
                {
                    id: 4,
                    name: "ç¾å›½é˜Ÿé•¿ç³»åˆ—",
                    color: "#00a8e8",
                    characters: [2, 13, 14]
                },
                {
                    id: 5,
                    name: "é’¢é“ä¾ ç³»åˆ—",
                    color: "#e62429",
                    characters: [1, 18, 19]
                },
                {
                    id: 6,
                    name: "é›·ç¥ç³»åˆ—",
                    color: "#4e54c8",
                    characters: [3, 15, 20]
                }
            ]
        };

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            let networkChart = null;
            let timelineChart = null;
            let selectedMovies = new Set(mcuData.movies.map(m => m.id)); // é»˜è®¤å…¨é€‰
            let selectedYear = 2023; // é»˜è®¤æœ€æ–°å¹´ä»½
            let currentCommunities = [];
            let isPlayingTimeline = false;
            let timelineInterval = null;
            
            // åˆå§‹åŒ–ç½‘ç»œå›¾
            function initNetworkChart() {
                const networkChartDom = document.getElementById('network-chart');
                if (!networkChartDom) return;
                
                // ç§»é™¤åŠ è½½æç¤º
                const loading = networkChartDom.querySelector('.loading');
                if (loading) loading.remove();
                
                networkChart = echarts.init(networkChartDom);
                
                // ç”Ÿæˆç½‘ç»œæ•°æ®
                const networkData = generateNetworkData();
                
                const networkOption = {
                    backgroundColor: 'transparent',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            if (params.dataType === 'node') {
                                const character = mcuData.characters.find(c => c.id === params.data.id);
                                if (character) {
                                    const movies = character.movies.map(movieId => {
                                        const movie = mcuData.movies.find(m => m.id === movieId);
                                        return movie ? movie.title : '';
                                    }).filter(title => title);
                                    
                                    return `
                                        <div style="font-weight:bold;margin-bottom:5px;color:${character.color}">
                                            ${character.name}
                                        </div>
                                        <div style="margin-bottom:3px">
                                            <span style="color:#a0a0a0">æ¼”å‘˜:</span> ${character.actor}
                                        </div>
                                        <div style="margin-bottom:3px">
                                            <span style="color:#a0a0a0">å‡ºç°ç”µå½±:</span> ${movies.length}éƒ¨
                                        </div>
                                        <div style="margin-top:5px;color:#ffcc00">
                                            ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                                        </div>
                                    `;
                                }
                            }
                            return params.name;
                        },
                        backgroundColor: 'rgba(0,0,0,0.9)',
                        borderColor: '#ffcc00',
                        textStyle: {
                            color: '#fff'
                        }
                    },
                    legend: {
                        show: false
                    },
                    series: [{
                        type: 'graph',
                        layout: 'force',
                        force: {
                            repulsion: 300,
                            edgeLength: 100,
                            gravity: 0.1,
                            friction: 0.8
                        },
                        roam: true,
                        draggable: true,
                        focusNodeAdjacency: true,
                        symbolSize: function(data) {
                            // æ ¹æ®è§’è‰²ç±»å‹å’Œç”µå½±æ•°é‡å†³å®šèŠ‚ç‚¹å¤§å°
                            const character = mcuData.characters.find(c => c.id === data.id);
                            if (!character) return 20;
                            
                            const movieCount = character.movies.filter(movieId => 
                                selectedMovies.has(movieId) && 
                                mcuData.movies.find(m => m.id === movieId).year <= selectedYear
                            ).length;
                            
                            if (character.type === 'core') return 30 + movieCount * 3;
                            if (character.type === 'important') return 25 + movieCount * 2;
                            return 20 + movieCount;
                        },
                        edgeSymbol: ['none', 'arrow'],
                        edgeSymbolSize: [4, 10],
                        edgeLabel: {
                            show: false
                        },
                        label: {
                            show: true,
                            position: 'right',
                            formatter: '{b}',
                            fontSize: 12,
                            color: '#e6e6e6'
                        },
                        lineStyle: {
                            color: 'source',
                            curveness: 0.1,
                            opacity: 0.6,
                            width: function(data) {
                                // è¿çº¿å®½åº¦åŸºäºå…±åŒç”µå½±æ•°é‡
                                return Math.min(5, 1 + data.value * 0.5);
                            }
                        },
                        emphasis: {
                            focus: 'adjacency',
                            lineStyle: {
                                width: 3
                            },
                            label: {
                                fontWeight: 'bold',
                                fontSize: 14
                            }
                        },
                        categories: [
                            { name: 'æ ¸å¿ƒè§’è‰²', itemStyle: { color: '#e62429' } },
                            { name: 'é‡è¦è§’è‰²', itemStyle: { color: '#00a8e8' } },
                            { name: 'æ¬¡è¦è§’è‰²', itemStyle: { color: '#ffcc00' } }
                        ],
                        data: networkData.nodes,
                        links: networkData.links
                    }]
                };
                
                networkChart.setOption(networkOption);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                networkChart.on('click', function(params) {
                    if (params.dataType === 'node') {
                        showCharacterInfo(params.data.id);
                    }
                });
                
                // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜
                window.addEventListener('resize', function() {
                    networkChart.resize();
                });
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStatistics(networkData);
            }
            
            // ç”Ÿæˆç½‘ç»œæ•°æ®
            function generateNetworkData() {
                const nodes = [];
                const links = [];
                const linkMap = {}; // ç”¨äºé¿å…é‡å¤è¿çº¿
                
                // ç­›é€‰ç¬¦åˆæ¡ä»¶çš„è§’è‰²ï¼ˆå‡ºç°åœ¨é€‰ä¸­çš„ç”µå½±ä¸­ä¸”åœ¨é€‰ä¸­å¹´ä»½ä¹‹å‰ï¼‰
                const filteredCharacters = mcuData.characters.filter(character => {
                    const validMovies = character.movies.filter(movieId => 
                        selectedMovies.has(movieId) && 
                        mcuData.movies.find(m => m.id === movieId).year <= selectedYear
                    );
                    return validMovies.length > 0;
                });
                
                // åˆ›å»ºèŠ‚ç‚¹
                filteredCharacters.forEach(character => {
                    const category = character.type === 'core' ? 0 : 
                                    character.type === 'important' ? 1 : 2;
                    
                    // è®¡ç®—åœ¨ç­›é€‰æ¡ä»¶ä¸‹çš„ç”µå½±æ•°é‡
                    const movieCount = character.movies.filter(movieId => 
                        selectedMovies.has(movieId) && 
                        mcuData.movies.find(m => m.id === movieId).year <= selectedYear
                    ).length;
                    
                    nodes.push({
                        id: character.id,
                        name: character.name,
                        category: category,
                        value: movieCount,
                        symbolSize: 20 + movieCount * 2,
                        itemStyle: {
                            color: character.color
                        },
                        label: {
                            show: movieCount > 0 // åªåœ¨æœ‰ç”µå½±æ—¶æ˜¾ç¤ºæ ‡ç­¾
                        }
                    });
                });
                
                // åˆ›å»ºè¿çº¿ï¼ˆè§’è‰²é—´çš„å…±åŒç”µå½±å…³ç³»ï¼‰
                for (let i = 0; i < filteredCharacters.length; i++) {
                    for (let j = i + 1; j < filteredCharacters.length; j++) {
                        const char1 = filteredCharacters[i];
                        const char2 = filteredCharacters[j];
                        
                        // æ‰¾å‡ºå…±åŒç”µå½±
                        const commonMovies = char1.movies.filter(movieId => 
                            char2.movies.includes(movieId) && 
                            selectedMovies.has(movieId) &&
                            mcuData.movies.find(m => m.id === movieId).year <= selectedYear
                        );
                        
                        if (commonMovies.length > 0) {
                            const linkKey = `${Math.min(char1.id, char2.id)}-${Math.max(char1.id, char2.id)}`;
                            
                            // é¿å…é‡å¤è¿çº¿
                            if (!linkMap[linkKey]) {
                                linkMap[linkKey] = true;
                                
                                links.push({
                                    source: char1.id,
                                    target: char2.id,
                                    value: commonMovies.length,
                                    lineStyle: {
                                        width: Math.min(5, 1 + commonMovies.length * 0.5),
                                        color: getLinkColor(commonMovies.length)
                                    }
                                });
                            }
                        }
                    }
                }
                
                return { nodes, links };
            }
            
            // è·å–è¿çº¿é¢œè‰²
            function getLinkColor(commonMoviesCount) {
                if (commonMoviesCount >= 3) return '#ffcc00';
                if (commonMoviesCount === 2) return '#00a8e8';
                return '#a0a0a0';
            }
            
            // åˆå§‹åŒ–æ—¶é—´çº¿å›¾è¡¨
            function initTimelineChart() {
                const timelineChartDom = document.getElementById('timeline-chart');
                if (!timelineChartDom) return;
                
                timelineChart = echarts.init(timelineChartDom);
                
                // æŒ‰å¹´ä»½åˆ†ç»„ç”µå½±
                const yearData = {};
                mcuData.movies.forEach(movie => {
                    if (!yearData[movie.year]) {
                        yearData[movie.year] = [];
                    }
                    yearData[movie.year].push(movie);
                });
                
                const years = Object.keys(yearData).sort((a, b) => a - b);
                const movieCounts = years.map(year => yearData[year].length);
                
                const timelineOption = {
                    backgroundColor: 'transparent',
                    tooltip: {
                        trigger: 'axis',
                        formatter: function(params) {
                            const year = params[0].axisValue;
                            const movies = yearData[year] || [];
                            let html = `<div style="font-weight:bold;margin-bottom:5px">${year}å¹´ (${movies.length}éƒ¨ç”µå½±)</div>`;
                            movies.forEach(movie => {
                                html += `<div style="margin:3px 0;color:${movie.color}">â€¢ ${movie.title}</div>`;
                            });
                            return html;
                        }
                    },
                    xAxis: {
                        type: 'category',
                        data: years,
                        axisLine: {
                            lineStyle: {
                                color: 'rgba(255, 255, 255, 0.3)'
                            }
                        },
                        axisLabel: {
                            color: '#e6e6e6'
                        }
                    },
                    yAxis: {
                        type: 'value',
                        min: 0,
                        max: 3,
                        axisLine: {
                            lineStyle: {
                                color: 'rgba(255, 255, 255, 0.3)'
                            }
                        },
                        axisLabel: {
                            color: '#e6e6e6'
                        },
                        splitLine: {
                            lineStyle: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    series: [{
                        type: 'bar',
                        data: movieCounts.map((count, index) => ({
                            value: count,
                            itemStyle: {
                                color: index % 2 === 0 ? '#e62429' : '#00a8e8'
                            }
                        })),
                        barWidth: '60%',
                        markLine: {
                            symbol: 'none',
                            label: {
                                formatter: 'å½“å‰æ—¶é—´: {c}',
                                position: 'insideEndTop',
                                color: '#ffcc00'
                            },
                            lineStyle: {
                                color: '#ffcc00',
                                width: 2,
                                type: 'dashed'
                            },
                            data: [{
                                xAxis: selectedYear
                            }]
                        }
                    }]
                };
                
                timelineChart.setOption(timelineOption);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                timelineChart.on('click', function(params) {
                    if (params.componentType === 'series') {
                        const year = params.name;
                        updateTimeFilter(parseInt(year));
                    }
                });
                
                window.addEventListener('resize', function() {
                    timelineChart.resize();
                });
            }
            
            // åˆå§‹åŒ–ç”µå½±åˆ—è¡¨
            function initMovieList() {
                const movieListElement = document.getElementById('movie-list');
                const movieCountElement = document.getElementById('movie-count');
                
                if (!movieListElement) return;
                
                movieListElement.innerHTML = '';
                
                // æŒ‰å¹´ä»½æ’åºç”µå½±
                const sortedMovies = [...mcuData.movies].sort((a, b) => a.year - b.year);
                
                sortedMovies.forEach(movie => {
                    const movieItem = document.createElement('div');
                    movieItem.className = `movie-item ${selectedMovies.has(movie.id) ? 'selected' : ''}`;
                    movieItem.innerHTML = `
                        <input type="checkbox" class="movie-checkbox" data-id="${movie.id}" ${selectedMovies.has(movie.id) ? 'checked' : ''}>
                        ${movie.title}
                        <span class="movie-year">${movie.year}</span>
                    `;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    movieItem.addEventListener('click', function(e) {
                        if (e.target.type !== 'checkbox') {
                            const checkbox = this.querySelector('.movie-checkbox');
                            checkbox.checked = !checkbox.checked;
                            toggleMovieSelection(movie.id, checkbox.checked);
                        }
                    });
                    
                    // å¤é€‰æ¡†äº‹ä»¶
                    const checkbox = movieItem.querySelector('.movie-checkbox');
                    checkbox.addEventListener('change', function() {
                        toggleMovieSelection(movie.id, this.checked);
                    });
                    
                    movieListElement.appendChild(movieItem);
                });
                
                movieCountElement.textContent = sortedMovies.length;
            }
            
            // åˆ‡æ¢ç”µå½±é€‰æ‹©
            function toggleMovieSelection(movieId, isSelected) {
                if (isSelected) {
                    selectedMovies.add(movieId);
                } else {
                    selectedMovies.delete(movieId);
                }
                
                // æ›´æ–°UI
                const movieItem = document.querySelector(`.movie-checkbox[data-id="${movieId}"]`).closest('.movie-item');
                movieItem.classList.toggle('selected', isSelected);
                
                // æ›´æ–°ç½‘ç»œå›¾
                updateNetwork();
            }
            
            // åˆå§‹åŒ–ç¤¾åŒºåˆ—è¡¨
            function initCommunityList() {
                const communityListElement = document.getElementById('community-list');
                const communityCountElement = document.getElementById('community-count');
                
                if (!communityListElement) return;
                
                communityListElement.innerHTML = '';
                currentCommunities = [];
                
                // æ£€æµ‹ç¤¾åŒºï¼ˆè¿™é‡Œä½¿ç”¨é¢„å®šä¹‰çš„ç¤¾åŒºï¼‰
                mcuData.communities.forEach(community => {
                    // æ£€æŸ¥ç¤¾åŒºä¸­çš„è§’è‰²åœ¨å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ˜¯å¦å­˜åœ¨
                    const validCharacters = community.characters.filter(charId => {
                        const character = mcuData.characters.find(c => c.id === charId);
                        if (!character) return false;
                        
                        return character.movies.some(movieId => 
                            selectedMovies.has(movieId) && 
                            mcuData.movies.find(m => m.id === movieId).year <= selectedYear
                        );
                    });
                    
                    if (validCharacters.length > 0) {
                        currentCommunities.push({
                            ...community,
                            characterCount: validCharacters.length
                        });
                    }
                });
                
                // æ˜¾ç¤ºç¤¾åŒº
                currentCommunities.forEach(community => {
                    const communityItem = document.createElement('div');
                    communityItem.className = 'movie-item';
                    communityItem.innerHTML = `
                        <div style="display:flex;align-items:center;width:100%;">
                            <div style="width:12px;height:12px;border-radius:50%;background:${community.color};margin-right:10px;"></div>
                            ${community.name}
                            <span style="margin-left:auto;font-size:0.8rem;color:#a0a0a0;">
                                ${community.characterCount}ä¸ªè§’è‰²
                            </span>
                        </div>
                    `;
                    
                    communityItem.addEventListener('click', function() {
                        highlightCommunity(community.id);
                    });
                    
                    communityListElement.appendChild(communityItem);
                });
                
                communityCountElement.textContent = currentCommunities.length;
            }
            
            // æ›´æ–°ç½‘ç»œå›¾
            function updateNetwork() {
                if (!networkChart) return;
                
                const networkData = generateNetworkData();
                networkChart.setOption({
                    series: [{
                        data: networkData.nodes,
                        links: networkData.links
                    }]
                });
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStatistics(networkData);
                
                // æ›´æ–°ç¤¾åŒºåˆ—è¡¨
                initCommunityList();
            }
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            function updateStatistics(networkData) {
                document.getElementById('total-nodes').textContent = networkData.nodes.length;
                document.getElementById('total-edges').textContent = networkData.links.length;
                document.getElementById('total-movies').textContent = selectedMovies.size;
                
                // è®¡ç®—å¹³å‡å…³è”åº¦
                const totalDegree = networkData.links.reduce((sum, link) => sum + link.value, 0);
                const avgDegree = networkData.nodes.length > 0 ? (totalDegree / networkData.nodes.length).toFixed(2) : '0';
                document.getElementById('avg-degree').textContent = avgDegree;
            }
            
            // æ›´æ–°æ—¶é—´ç­›é€‰
            function updateTimeFilter(year) {
                selectedYear = year;
                document.getElementById('time-value').textContent = year;
                document.getElementById('time-slider').value = year;
                
                // æ›´æ–°ç½‘ç»œå›¾
                updateNetwork();
                
                // æ›´æ–°æ—¶é—´çº¿å›¾
                if (timelineChart) {
                    timelineChart.setOption({
                        series: [{
                            markLine: {
                                data: [{
                                    xAxis: selectedYear
                                }]
                            }
                        }]
                    });
                }
            }
            
            // æ˜¾ç¤ºè§’è‰²ä¿¡æ¯
            function showCharacterInfo(characterId) {
                const character = mcuData.characters.find(c => c.id === characterId);
                if (!character) return;
                
                // è·å–è§’è‰²å‡ºç°çš„ç”µå½±
                const characterMovies = character.movies
                    .map(movieId => mcuData.movies.find(m => m.id === movieId))
                    .filter(movie => movie && selectedMovies.has(movie.id) && movie.year <= selectedYear);
                
                // è·å–å…³è”è§’è‰²
                const connectedCharacters = getConnectedCharacters(characterId);
                
                // æ›´æ–°å¼¹çª—å†…å®¹
                document.getElementById('character-avatar').innerHTML = character.avatar;
                document.getElementById('character-name').textContent = character.name;
                document.getElementById('character-actor').textContent = character.actor;
                document.getElementById('character-movie-count').textContent = characterMovies.length;
                document.getElementById('character-degree').textContent = connectedCharacters.length;
                document.getElementById('character-type').textContent = 
                    character.type === 'core' ? 'æ ¸å¿ƒè§’è‰²' : 
                    character.type === 'important' ? 'é‡è¦è§’è‰²' : 'æ¬¡è¦è§’è‰²';
                
                // æ›´æ–°ç”µå½±æ ‡ç­¾
                const moviesElement = document.getElementById('character-movies');
                moviesElement.innerHTML = '';
                characterMovies.forEach(movie => {
                    const tag = document.createElement('div');
                    tag.className = 'movie-tag';
                    tag.textContent = movie.title;
                    tag.style.background = movie.color + '30';
                    tag.style.color = movie.color;
                    moviesElement.appendChild(tag);
                });
                
                // æ›´æ–°å…³è”è§’è‰²æ ‡ç­¾
                const connectionsElement = document.getElementById('character-connections');
                connectionsElement.innerHTML = '';
                connectedCharacters.slice(0, 10).forEach(char => { // æœ€å¤šæ˜¾ç¤º10ä¸ª
                    const tag = document.createElement('div');
                    tag.className = 'movie-tag';
                    tag.textContent = char.name;
                    tag.style.background = char.color + '30';
                    tag.style.color = char.color;
                    connectionsElement.appendChild(tag);
                });
                
                if (connectedCharacters.length > 10) {
                    const moreTag = document.createElement('div');
                    moreTag.className = 'movie-tag';
                    moreTag.textContent = `+${connectedCharacters.length - 10}æ›´å¤š`;
                    moreTag.style.background = 'rgba(160, 160, 160, 0.2)';
                    moreTag.style.color = '#a0a0a0';
                    connectionsElement.appendChild(moreTag);
                }
                
                // æ˜¾ç¤ºå¼¹çª—
                document.getElementById('overlay').classList.add('active');
                document.getElementById('character-info').classList.add('active');
            }
            
            // è·å–å…³è”è§’è‰²
            function getConnectedCharacters(characterId) {
                const character = mcuData.characters.find(c => c.id === characterId);
                if (!character) return [];
                
                const connected = [];
                
                // æ‰¾å‡ºæ‰€æœ‰æœ‰å…³è”çš„è§’è‰²ï¼ˆæœ‰å…±åŒç”µå½±ï¼‰
                mcuData.characters.forEach(otherChar => {
                    if (otherChar.id === characterId) return;
                    
                    const commonMovies = character.movies.filter(movieId => 
                        otherChar.movies.includes(movieId) && 
                        selectedMovies.has(movieId) &&
                        mcuData.movies.find(m => m.id === movieId).year <= selectedYear
                    );
                    
                    if (commonMovies.length > 0) {
                        connected.push({
                            id: otherChar.id,
                            name: otherChar.name,
                            color: otherChar.color,
                            commonMovies: commonMovies.length
                        });
                    }
                });
                
                // æŒ‰å…±åŒç”µå½±æ•°é‡æ’åº
                return connected.sort((a, b) => b.commonMovies - a.commonMovies);
            }
            
            // é«˜äº®ç¤¾åŒº
            function highlightCommunity(communityId) {
                if (!networkChart) return;
                
                const community = currentCommunities.find(c => c.id === communityId);
                if (!community) return;
                
                // é«˜äº®ç¤¾åŒºä¸­çš„è§’è‰²
                const highlightNodes = community.characters.map(charId => ({
                    id: charId,
                    itemStyle: {
                        borderColor: community.color,
                        borderWidth: 3,
                        shadowBlur: 10,
                        shadowColor: community.color
                    }
                }));
                
                networkChart.dispatchAction({
                    type: 'highlight',
                    seriesIndex: 0,
                    dataIndex: highlightNodes.map((_, i) => i)
                });
            }
            
            // é«˜äº®æ ¸å¿ƒè§’è‰²
            function highlightCentralCharacters() {
                if (!networkChart) return;
                
                const coreCharacters = mcuData.characters.filter(c => c.type === 'core');
                const coreNodeIndices = [];
                
                // è·å–å½“å‰å›¾ä¸­çš„æ ¸å¿ƒè§’è‰²ç´¢å¼•
                const currentOption = networkChart.getOption();
                if (currentOption.series && currentOption.series[0].data) {
                    const nodes = currentOption.series[0].data;
                    coreCharacters.forEach(coreChar => {
                        const nodeIndex = nodes.findIndex(node => node.id === coreChar.id);
                        if (nodeIndex !== -1) {
                            coreNodeIndices.push(nodeIndex);
                        }
                    });
                }
                
                networkChart.dispatchAction({
                    type: 'highlight',
                    seriesIndex: 0,
                    dataIndex: coreNodeIndices
                });
            }
            
            // æ’­æ”¾æ—¶é—´çº¿åŠ¨ç”»
            function playTimeline() {
                if (isPlayingTimeline) return;
                
                isPlayingTimeline = true;
                const playButton = document.getElementById('play-timeline');
                playButton.innerHTML = '<i class="fas fa-pause"></i> æš‚åœæ—¶é—´çº¿';
                playButton.classList.remove('secondary');
                playButton.classList.add('warning');
                
                let year = 2008;
                updateTimeFilter(year);
                
                timelineInterval = setInterval(() => {
                    year++;
                    if (year > 2023) {
                        stopTimeline();
                        return;
                    }
                    updateTimeFilter(year);
                }, 1000);
            }
            
            // åœæ­¢æ—¶é—´çº¿åŠ¨ç”»
            function stopTimeline() {
                if (!isPlayingTimeline) return;
                
                isPlayingTimeline = false;
                clearInterval(timelineInterval);
                
                const playButton = document.getElementById('play-timeline');
                playButton.innerHTML = '<i class="fas fa-play"></i> æ’­æ”¾æ—¶é—´çº¿';
                playButton.classList.remove('warning');
                playButton.classList.add('secondary');
            }
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            function setupEventListeners() {
                // æ—¶é—´æ»‘å—
                const timeSlider = document.getElementById('time-slider');
                timeSlider.addEventListener('input', function() {
                    updateTimeFilter(parseInt(this.value));
                });
                
                // å…¨é€‰æŒ‰é’®
                document.getElementById('select-all').addEventListener('click', function() {
                    selectedMovies = new Set(mcuData.movies.map(m => m.id));
                    initMovieList();
                    updateNetwork();
                });
                
                // æ¸…ç©ºæŒ‰é’®
                document.getElementById('clear-all').addEventListener('click', function() {
                    selectedMovies.clear();
                    initMovieList();
                    updateNetwork();
                });
                
                // æ’­æ”¾æ—¶é—´çº¿æŒ‰é’®
                document.getElementById('play-timeline').addEventListener('click', function() {
                    if (isPlayingTimeline) {
                        stopTimeline();
                    } else {
                        playTimeline();
                    }
                });
                
                // é‡ç½®æ—¶é—´çº¿æŒ‰é’®
                document.getElementById('reset-timeline').addEventListener('click', function() {
                    stopTimeline();
                    updateTimeFilter(2023);
                });
                
                // æ£€æµ‹ç¤¾åŒºæŒ‰é’®
                document.getElementById('detect-communities').addEventListener('click', function() {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ ç¤¾åŒºæ£€æµ‹ç®—æ³•
                    // ç›®å‰ä½¿ç”¨é¢„å®šä¹‰çš„ç¤¾åŒº
                    initCommunityList();
                });
                
                // é‡ç½®ç¤¾åŒºæŒ‰é’®
                document.getElementById('reset-communities').addEventListener('click', function() {
                    // é‡ç½®é«˜äº®
                    if (networkChart) {
                        networkChart.dispatchAction({
                            type: 'downplay',
                            seriesIndex: 0
                        });
                    }
                });
                
                // é«˜äº®æ ¸å¿ƒè§’è‰²æŒ‰é’®
                document.getElementById('highlight-central').addEventListener('click', function() {
                    highlightCentralCharacters();
                });
                
                // é‡ç½®è§†å›¾æŒ‰é’®
                document.getElementById('reset-network').addEventListener('click', function() {
                    if (networkChart) {
                        networkChart.dispatchAction({
                            type: 'restore'
                        });
                    }
                });
                
                // è§’è‰²æœç´¢
                const characterSearch = document.getElementById('character-search');
                characterSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    if (searchTerm.length === 0) return;
                    
                    // æŸ¥æ‰¾åŒ¹é…çš„è§’è‰²
                    const matchedCharacters = mcuData.characters.filter(character => 
                        character.name.toLowerCase().includes(searchTerm) ||
                        character.actor.toLowerCase().includes(searchTerm)
                    );
                    
                    if (matchedCharacters.length > 0) {
                        // é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„è§’è‰²
                        const currentOption = networkChart.getOption();
                        if (currentOption.series && currentOption.series[0].data) {
                            const nodes = currentOption.series[0].data;
                            const matchedIndices = [];
                            
                            matchedCharacters.forEach(matchedChar => {
                                const nodeIndex = nodes.findIndex(node => node.id === matchedChar.id);
                                if (nodeIndex !== -1) {
                                    matchedIndices.push(nodeIndex);
                                }
                            });
                            
                            if (matchedIndices.length > 0) {
                                networkChart.dispatchAction({
                                    type: 'highlight',
                                    seriesIndex: 0,
                                    dataIndex: matchedIndices
                                });
                            }
                        }
                    }
                });
                
                // å…³é—­è§’è‰²ä¿¡æ¯å¼¹çª—
                document.getElementById('close-info').addEventListener('click', function() {
                    document.getElementById('overlay').classList.remove('active');
                    document.getElementById('character-info').classList.remove('active');
                });
                
                // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
                document.getElementById('overlay').addEventListener('click', function() {
                    this.classList.remove('active');
                    document.getElementById('character-info').classList.remove('active');
                });
            }
            
            // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
            function initAll() {
                // åˆå§‹åŒ–å›¾è¡¨
                initNetworkChart();
                initTimelineChart();
                
                // åˆå§‹åŒ–æ§ä»¶
                initMovieList();
                initCommunityList();
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
                setupEventListeners();
            }
            
            // å¼€å§‹åˆå§‹åŒ–
            initAll();
        });
    </script>
</body>
</html>